<template>
	<div class="user-profile-modal">
		<modal
			:adaptive="true"
			:width="'100%'"
			:maxWidth="560"
			:height="'auto'"
			name="user-profile-modal"
		>
			<template v-if="userProfile">
				<div class="header">
					{{ userProfile.username }}

					<FormButton
						transparent
						class="close-btn"
						@click="closeModal"
					>
						<i class="fas fa-times"></i>
					</FormButton>
				</div>
				<div class="content">
					<Tabs
						cache-lifetime="0"
						class="light"
						:options="{ useUrlFragment: false }"
					>
						<Tab name="Profile">
							User profile
							{{ userProfile }}

							<div class="buttons-wrapper">
								<FormButton
									v-if="isOwnUser"
								>
									Edit profile
								</FormButton>
								<FormButton
									v-if="!isOwnUser"
									:disabled="!canChallengePLayer"
									@click="challengePlayer"
								>
									Challenge
								</FormButton>
							</div>
						</Tab>
						<Tab name="Stats">
							stats placeholder
						</Tab>
					</Tabs>
				</div>
			</template>
		</modal>
	</div>
</template>

<script>
	import { mapState, mapGetters } from 'vuex';
	import { Tabs, Tab } from 'vue-tabs-component';

	export default {
		components: {
			Tabs,
			Tab
		},
		computed: {
			...mapState('config', [
				'userStatuses'
			]),
			...mapGetters('lobby', [
				'userProfile'
			]),
			...mapGetters('auth', [
				'userSession'
			]),
			isOwnUser() {
				return this.userProfile.id === this.userSession.id;
			},
			canChallengePLayer() {
				return (
					this.userSession.status === this.userStatuses.ONLINE
					&& this.userProfile.status === this.userStatuses.ONLINE
					&& !this.isOwnUser
				);
			}
		},
		methods: {
			/**
			 * Closes the modal
			 */
			closeModal() {
				this.$modal.hide('user-profile-modal');
			},
			challengePlayer() {
				this.$emit('challenge', this.userProfile);
				this.closeModal();
			}
		}
	};
</script>

<style lang="scss">
	.user-profile-modal {
		.header {
			padding: 10px;
			background-color: $gray-darkest;
			color: $white;
			font-weight: bold;

			.close-btn {
				float: right;
				padding: 0px 5px;
				color: $white;

				svg {
					margin: 0px;
				}

				&:hover {
					background-color: $gray;
				}
			}
		}

		.content {
			padding: 5px;
			color: $text-color-dark;

			.tabs-component-panels {
				padding: 10px;
			}

			.buttons-wrapper {
				margin-top: 10px;
				text-align: center;
			}
		}
	}
</style>
